{% extends 'index.html' %}
{% load static %}  <!-- ¡Esta línea es crucial! -->

{% block extra_css %}
<link rel="stylesheet" href="{% static 'index.css' %}">
{% endblock %}

{% block content %}
<div class="table-toolbar">
    <div class="search-container">
        <input type="text" placeholder="Buscar..." class="search-input" id="searchInput">
        <button class="search-button">
            <ion-icon name="search-outline"></ion-icon>
        </button>
    </div>
    <button class="add-new-button" onclick="openModal()">
        <ion-icon name="add-outline"></ion-icon>
        Agregar
    </button>
</div>

<!-- Modal para registrar PDFs -->
<div id="pdfModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Registrar Nuevo PDF</h2>
        <form id="pdfForm">
            <div class="form-group">
                <label for="titulo">Título:</label>
                <input type="text" id="titulo" required>
            </div>
            <div class="form-group">
                <label for="fecha">Fecha:</label>
                <input type="date" id="fecha" required>
            </div>
            <div class="form-group">
                <label for="tomo">Tomo:</label>
                <input type="number" id="tomo" required>
            </div>
            <div class="form-group">
                <label for="paginas">Páginas:</label>
                <input type="number" id="paginas" required>
            </div>
            <div class="form-group">
                <label for="pdfFile">Archivo PDF:</label>
                <input type="file" id="pdfFile" accept=".pdf" required>
            </div>
            <button type="button" class="submit-button" onclick="savePDF()">Guardar</button>
        </form>
    </div>
</div>

<!-- Tabla de registros -->
<div class="members-table">
    <table id="pdfTable">
        <thead>
            <tr>
                <th>Título</th>
                <th>Fecha</th>
                <th>Tomo</th>
                <th>Páginas</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <tr>
                <td colspan="5">No hay archivos registrados</td>
            </tr>
        </tbody>
    </table>
</div>

<script>
    // Funciones JavaScript (las mismas del código anterior)
    function openModal() {
        document.getElementById('pdfModal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('pdfModal').style.display = 'none';
        document.getElementById('pdfForm').reset();
    }

    function savePDF() {
        const titulo = document.getElementById('titulo').value;
        const fecha = document.getElementById('fecha').value;
        const tomo = document.getElementById('tomo').value;
        const paginas = document.getElementById('paginas').value;
        const pdfFile = document.getElementById('pdfFile').files[0];

        if (!titulo || !fecha || !tomo || !paginas || !pdfFile) {
            alert("Complete todos los campos");
            return;
        }

        const tableBody = document.getElementById('tableBody');
        const newRow = document.createElement('tr');

        newRow.innerHTML = `
            <td>${titulo}</td>
            <td>${fecha}</td>
            <td>${tomo}</td>
            <td>${paginas}</td>
            <td>
                <button class="action-button view" onclick="viewPDF('${pdfFile.name}')">
                    <ion-icon name="eye-outline"></ion-icon>
                </button>
                <button class="action-button delete" onclick="deleteRow(this)">
                    <ion-icon name="trash-outline"></ion-icon>
                </button>
            </td>
        `;

        if (tableBody.innerHTML.includes('No hay archivos')) {
            tableBody.innerHTML = '';
        }

        tableBody.appendChild(newRow);
        closeModal();
    }

    function deleteRow(button) {
        if (confirm("¿Eliminar este registro?")) {
            const row = button.closest('tr');
            row.remove();
            
            const tableBody = document.getElementById('tableBody');
            if (tableBody.children.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5">No hay archivos registrados</td></tr>';
            }
        }
    }

    function viewPDF(filename) {
        alert(`Funcionalidad de vista previa para: ${filename}`);
        // Implementar lógica para visualizar PDF
    }

    // Búsqueda en tiempo real
    document.getElementById('searchInput').addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const rows = document.querySelectorAll('#tableBody tr');

        rows.forEach(row => {
            const title = row.cells[0].textContent.toLowerCase();
            row.style.display = title.includes(searchTerm) ? '' : 'none';
        });
    });
</script>
{% endblock %}